# ============================================================================
# Ansible Configuration File
# ============================================================================
#
# WHAT: Central configuration for Ansible behavior
# WHERE: Project root (ansible/ansible.cfg)
# WHY: Customize Ansible defaults for our AWS infrastructure
#
# KEY SETTINGS:
# - Dynamic inventory from AWS EC2
# - SSH connection optimization
# - Privilege escalation for system tasks
# - Fact caching for performance
# ============================================================================

[defaults]
# ----------------------------------------------------------------------------
# Inventory Configuration
# ----------------------------------------------------------------------------
# DEFAULT: Use dynamic AWS EC2 inventory
# FALLBACK: Can override with -i flag for static inventory
inventory = inventory/aws_ec2.yml

# ----------------------------------------------------------------------------
# Connection Settings
# ----------------------------------------------------------------------------
# Remote user for SSH connections (Ubuntu AMI default user)
remote_user = ubuntu

# Private key for authentication
# NOTE: Update path to match your key location
# SECURITY: Never commit private keys to git!
private_key_file = ~/.ssh/dgp-kp-1.pem

# Disable host key checking (WARNING: Only for testing/development)
# PRODUCTION: Set to True and add hosts to known_hosts
host_key_checking = False

# ----------------------------------------------------------------------------
# Performance Optimization
# ----------------------------------------------------------------------------
# Gathering: smart = only gather facts when needed
gathering = smart

# Fact caching: Store facts to avoid re-gathering on each run
fact_caching = jsonfile
fact_caching_connection = /tmp/ansible_facts
fact_caching_timeout = 3600  # 1 hour

# SSH pipelining: Reduces number of SSH operations (faster!)
# NOTE: Requires 'requiretty' to be disabled in /etc/sudoers
pipelining = True

# ----------------------------------------------------------------------------
# Output & Logging
# ----------------------------------------------------------------------------
# Disable retry files (they clutter the directory)
retry_files_enabled = False

# Callback plugins for better output
stdout_callback = yaml
bin_ansible_callbacks = True

# Display skipped tasks
display_skipped_hosts = False

# ----------------------------------------------------------------------------
# Security & Vault
# ----------------------------------------------------------------------------
# Vault password file (optional - can use --ask-vault-pass instead)
# vault_password_file = ~/.ansible_vault_pass

# ============================================================================
# Privilege Escalation (sudo)
# ============================================================================
# WHY: Most system tasks (Docker install, apt, etc.) require root
# HOW: Uses 'sudo' to become root (passwordless sudo configured)
[privilege_escalation]
become = True
become_method = sudo
become_user = root
become_ask_pass = False

# ============================================================================
# SSH Connection
# ============================================================================
# Advanced SSH settings for better performance and reliability
[ssh_connection]
# SSH multiplexing: Reuse connections (much faster for multiple tasks)
ssh_args = -o ControlMaster=auto -o ControlPersist=60s -o StrictHostKeyChecking=no

# Control path for SSH multiplexing
control_path = /tmp/ansible-ssh-%%h-%%p-%%r

# Pipelining (duplicate of [defaults] but some versions read from here)
pipelining = True

# Transfer method (smart = automatic selection)
transfer_method = smart

# ============================================================================
# Inventory Plugins
# ============================================================================
# Enable AWS EC2 dynamic inventory plugin
[inventory]
enable_plugins = aws_ec2, host_list, yaml, ini

# Cache inventory for faster repeated runs
cache = True
cache_plugin = jsonfile
cache_timeout = 3600
cache_connection = /tmp/ansible_inventory_cache

# ============================================================================
# Colors (optional but makes output prettier!)
# ============================================================================
[colors]
highlight = white
verbose = blue
warn = bright purple
error = red
debug = dark gray
deprecate = purple
skip = cyan
unreachable = red
ok = green
changed = yellow
diff_add = green
diff_remove = red
diff_lines = cyan
